(window.webpackJsonp=window.webpackJsonp||[]).push([[429],{2037:function(e,n,t){"use strict";t.r(n);var r=t(1),c=(t(23),t(16),t(19),t(137)),o=t(179),d=t(21),l=t(22),m=t.n(l);function v(){return w.apply(this,arguments)}function w(){return w=Object(r.a)(regeneratorRuntime.mark((function e(){var n,t,r,c=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=c.length>0&&void 0!==c[0]?c[0]:0,d.a.debug("Handling UserSignup UTM params"),!(n>30)){e.next=6;break}throw new Error("Failed to set up user");case 6:n++;case 7:return e.next=9,new Promise((function(e){return setTimeout(e,1e3)}));case 9:if(t=window.$nuxt.$api){e.next=12;break}return e.abrupt("return");case 12:if(r={utm_source:m.a.get("utm_source")||"empty",utm_medium:m.a.get("utm_medium")||"(not set)",utm_campaign:m.a.get("utm_campaign")||void 0,currency:m.a.get("currency")||null,language:m.a.get("language")||void 0},0!==Object.keys(r).length){e.next=15;break}return e.abrupt("return");case 15:return e.prev=15,e.next=18,t.patch("/api/v3/users/me",r);case 18:e.next=26;break;case 20:if(e.prev=20,e.t0=e.catch(15),e.t0.response){e.next=24;break}throw e.t0;case 24:if(404!==e.t0.response.status){e.next=26;break}return e.abrupt("return",v(n));case 26:case"end":return e.stop()}}),e,null,[[15,20]])}))),w.apply(this,arguments)}o.a.$on(c.a.UserSignedIn,(function(e){var n,t,r=e.user,l=e.method,v=e.enterprise,w=e.track_analytics,h=void 0===w||w;(d.a.debug("Handling UserSignedIn",r),h&&o.a.$emit(c.a.AnalyticsGA4Event,{event:"login",userId:r.id,method:l}),null===(n=window.$nuxt)||void 0===n||null===(t=n.$sentry)||void 0===t||t.setUser({id:r.id,email:r.email}),v.is_whitelabel)||(m.a.get("currency")!==r.currency&&(m.a.set("currency",r.currency),o.a.$emit(c.a.CurrencyChange,r.currency)),m.a.remove("unauthed_cart"))})),o.a.$on(c.a.UserRegistered,function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(n){var t,r,l,w,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=n.user,w=n.method,h=n.enterprise,d.a.debug("Handling UserRegistered",l),v().catch((function(e){return d.a.error(e)})),o.a.$emit(c.a.AnalyticsGA4Event,{event:"sign_up",userId:l.id,method:w}),null===(t=window.$nuxt)||void 0===t||null===(r=t.$sentry)||void 0===r||r.setUser({id:l.id,email:l.email}),m.a.remove("unauthed_cart"),!h.is_whitelabel){e.next=8;break}return e.abrupt("return");case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),o.a.$on(c.a.UserUpdatedAttributes,(function(e){var n,t,r=e.user,c=e.enterprise;d.a.debug("Handling UserUpdatedAttributes",r),m.a.remove("unauthed_cart"),c.is_whitelabel||(r.given_name||r.family_name)&&(null===(n=window.$nuxt)||void 0===n||null===(t=n.$sentry)||void 0===t||t.setUser({id:r.id,email:r.email}))})),o.a.$on(c.a.UserSignedOut,(function(e){var n,t,r=e.enterprise;d.a.debug("Handling UserSignedOut"),null===(n=window.$nuxt)||void 0===n||null===(t=n.$sentry)||void 0===t||t.setUser(null),r.is_whitelabel}))}}]);